<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>模板设计</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/css/hospital.css">
    <link rel="stylesheet" href="/css/animate.min.css">
    <link rel="stylesheet" href="/css/summernote.css">
    <link rel="stylesheet" href="/css/bootstrap-table.css">
    <script src="/js/beautifyhtml.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="/plugs/zTree/css/zTreeStyle/zTreeStyle.css">
    <script src="/plugs/zTree/js/jquery.ztree.core.js"></script>
    <script src="/plugs/zTree/js/jquery.ztree.exhide.js"></script>
    <script src="/plugs/zTree/js/fuzzysearch.js"></script>
    <script src="/plugs/zTree/js/jquery.ztree.excheck.js"></script>
    <script src="https://use.fontawesome.com/38f0aa120f.js"></script>
    <script src="/js/bootstrap-table.js"></script>
    <script src="/js/bootstrap-table-zh-CN.js"></script>
</head>
<style>
    .ztree * {
        font-size: 18px;
    }
</style>
<body>
<div th:replace="navigation :: nav"></div>
<div class="container-fluid main">
    <div class="row">
        <div class="col-xs-12 col-md-12">
            <div class="col-xs-3" style="border:1px #e1e1e1;border-right-style: solid">
                <div class="row">
                    <span style="font-size: 25px" th:text="${patient.patientName}"></span><span style="margin-left: 10px" th:text="${patient.patientSex}==0?'女':'男'"></span><br>
                    住院号 <span th:text="${patient.hospitalizationNumber}"> </span>
                    <br>
                    出生日期 <span th:text="${patient.patientBirthday}"> </span>
                    <br>
                    <a>链接到CDR</a>
                    <a style="margin-left: 30px">展开其他随访组</a>
                </div>
                <div class="row">
                    <button class="btn btn-info">选择诊疗方案</button>
                </div>
                <hr>
                <div>
                    <ul id="treeDemo" class="ztree"></ul>
                </div>
            </div>
            <div class="col-xs-9" style="border:1px #e1e1e1;border-left-style: solid">
                <div class="row">
                    <label>随访进度及计划</label>
                    <table border="1px" style="width: 600px;height: 70px;text-align: center">
                        <tr>
                            <td>基本信息</td>
                            <td>体格检查</td>
                            <td>实验室检查</td>
                            <td>随访信息表</td>
                            <td>查看完整随访计划</td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>
                                <button type="button" data-toggle="modal" data-target="#myModal" class="btn btn-info btn-sm"><i class="fa fa-search"></i></button>
                            </td>
                        </tr>
                    </table>
                    <hr>
                    <div class="row" id="formbox">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--完整随访列表-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">随访计划</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="tableL01"></table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="window.location.href='export'">导出为Excel</button>
            </div>
        </div>
    </div>
</div>
<div class="col-xs-9" style="border-style: dashed;border-color: #e1e1e1;height: 590px;overflow: auto">
    <form style="margin: 30px">
        <div class="row form-body form-horizontal m-t">
            <div class="col-md-12 droppable sortable ui-droppable ui-sortable">


            </div>
</body>
<script>

    $(document).ready(function () {
        $.getJSON('',{},function () {

        })
    })

    var zTreeObj;
    // zTree 的参数配置，深入使用请参考 API 文档（setting 配置详解）
    var setting = {
        check: {
            enable: true,
            chkStyle: "checkbox"
        },
        view: {
            nameIsHTML: true, //允许name支持html
            selectedMulti: false,
            showIcon: false
        },
        edit: {
            enable: false,
            editNameSelectAll: false
        },
        data: {

            simpleData: {
                enable: true
            }
        },
        callback: {
            onClick: zTreeOnClick
        },
        async: {
            enable: true,
            url: '/getLableTree',
        }
    };



    function zTreeOnClick(event, treeId, treeNode) {
        //alert(treeNode.tId + ", " + treeNode.name);
        var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
        if (treeNode.checked){
            treeObj.checkNode(treeNode,false, true);
            $("#info").remove();
        }else {
            treeObj.checkNode(treeNode,true, true);
            $(tableList(treeNode.id)).appendTo($(".sortable"));
        }
    }
    //--------------------
    function tableList(type,name,id){
        console.log(type);
        console.log(name);
        console.log(id);
        var content = "";
        var tou = '<div class="form-group draggable ui-draggable dropped" id="info"><div class="row"><div class="col-sm-7">';
        console.log(tou)
        switch (type) {
            case "title":
                var title = '<h5 id="'+id+'">'+name+'</h5><hr>';
                content = tou + title + '</div>';
                break;
            case "date":
                var title = '<div class="input-group"><span class="input-group-addon" id="'+id+'">'+name+'</span><input type="date" class="form-control"></div>';
                content = tou + title + '</div></div>';
                break;
            case "input":
                var title = '<div class="input-group"><span class="input-group-addon" id="'+id+'">'+name+'</span><input type="text" class="form-control" placeholder="请输入"></div>';
                content = tou + title + '</div></div> ';
                break;
            case "select":
                var title = '<div class="input-group"><span class="input-group-addon" id="'+id+'">'+name+'</span><select class="form-control"><option>请选择</option></select></div>';
                content = tou + title + '</div></div>';
                break;
            case "number":
                var title = '<div class="input-group"><span class="input-group-addon" id="'+id+'">'+name+'</span><input type="number" class="form-control" placeholder="请输入"></div>';
                content = tou + title + '</div></div>';
                break;
            case "textarea":
                //多行文本
                var textarea = '<textarea class="form-control" placeholder="请输入文本"></textarea>';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">多行文本：</label><div class="col-sm-7">' + textarea + '</div><p class="tools col-sm-3"><a class="edit-link" name="textarea" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "radio":
                //单选框
                var radom = Math.ceil(Math.random() * 100000);
                var radio = '<label class="radio-inline"><input type="radio" value="默认1" name="rad' + radom + '" checked> 默认1</label><label class="radio-inline"><input type="radio" name="rad' + radom + '" value="默认2"> 默认2</label>';
                content = '<div class="form-group draggable ui-draggable dropped"><div class="col-sm-7"><label>单选：</label></div><div class="col-sm-7">' + radio + '</div><p class="tools col-sm-3"><button type="button" class="btn btn-default edit" name="radio">';
                break;
            case "checkbox":
                //多选框
                var checkbox = '<label class="radio-inline"><input type="checkbox" name="默认1" value="默认1"> 默认1</label><label class="radio-inline""><input type="checkbox" name="默认2" value="默认2"> 默认2</label>';
                content = '<div class="form-group draggable ui-draggable dropped"><div class="col-sm-7"><label>多选：</label></div><div class="col-sm-7">' + checkbox + '</div><p class="tools col-sm-3"><button type="button" class="btn btn-default edit" name="checkbox">';
                break;
            case "datetime":
                //时间
                var datetime = '<input readonly="" class="form-control form_datetime" type="text" style="border: 1px solid #e5e6e7;">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">文本：</label><div class="col-sm-7">' + datetime + '</div><p class="tools col-sm-3"><a class="edit-link" name="datetime" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a></p></div>';
                break;
            case "file":
                //上传
                var file = '<input class="file uploadfile" type="file" multiple data-min-file-count="1">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">上传：</label><div class="col-sm-7">' + file + '</div><p class="tools col-sm-3"><a class="edit-link" name="file" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a></p></div>';
                break;
            case "picker":
                //省市区
                var picker = '<form class="form-inline"><div class="distpicker"><div class="form-group" style="margin:0px; padding-right:10px;"><label class="sr-only" for="province10">Province</label><select class="form-control" id="province10"></select></div><div class="form-group" style="margin:0px; padding-right:10px;"><label class="sr-only" for="city10">City</label><select class="form-control" id="city10"></select></div><div class="form-group" style="margin:0px; padding-right:10px;"><label class="sr-only" for="district10">District</label><select class="form-control" id="district10"></select></div></div></form>';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">省市区：</label><div class="col-sm-7">' + picker + '</div><p class="tools col-sm-3"><a class="edit-link" name="picker" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a></p></div>';
                break;
            case "name":
                //姓名
                var text = '<input type="text" class="form-control" placeholder="请输入你的姓名">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">姓名：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "phone":
                //电话
                var text = '<input type="text" class="form-control" placeholder="请输入你的电话">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">电话：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "email":
                //邮箱
                var text = '<input type="text" class="form-control" placeholder="请输入你的邮箱">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">邮箱：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "card":
                //身份证
                var text = '<input type="text" class="form-control" placeholder="请输入你的身份证">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">身份证：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "www":
                //姓名
                var text = '<input type="text" class="form-control" placeholder="请输入你的个人网站地址">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">个人网站：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "logo":
                //姓名
                var file = '<input class="file uploadfile" type="file" multiple data-min-file-count="1">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">上传Logo：</label><div class="col-sm-7">' + file + '</div><p class="tools col-sm-3"><a class="edit-link" name="file" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a></p></div>';
                break;
            case "sex":
                //性别
                var radom = Math.ceil(Math.random() * 100000);
                var radio = '<label class="radio-inline"><input type="radio" value="男" name="rad' + radom + '" checked> 男</label><label class="radio-inline"><input type="radio" name="rad' + radom + '" value="女"> 女</label>';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">性别：</label><div class="col-sm-7">' + radio + '</div><p class="tools col-sm-3"><a class="edit-link" name="radio" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a></p></div>';
                break;
            case "occupation":
                //职位
                var text = '<input type="text" class="form-control" placeholder="请输入你的职位">';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">职位：</label><div class="col-sm-7">' + text + '</div><p class="tools col-sm-3"><a class="edit-link" name="text" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
            case "profile":
                //个人简介
                var textarea = '<textarea class="form-control" placeholder="请输入你的简介"></textarea>';
                content = '<div class="form-group draggable ui-draggable dropped"><label class="col-sm-2 control-label">个人简介：</label><div class="col-sm-7">' + textarea + '</div><p class="tools col-sm-3"><a class="edit-link" name="textarea" title="设置"><i class="fa fa-cog fa-fw"></i></a><a class="remove-link"><i class="fa fa-trash-o"></i></a><label class="labcheck"><input type="checkbox"> 必填</label></p></div>';
                break;
        }
        return content;
    }
    // zTree 的数据属性，深入使用请参考 API 文档（zTreeNode 节点数据详解）
    var zNodes = [
        {name:"基线", open:true, children:[
                {name:"基本信息",id:"id",open:true,children:[
                        {name:"2019-11-23"}
                    ]},
                {name:"体格检查"}]},
        {name:"第一次随访",
            open:false,
            children:[
                {name:"随访信息表"},
                {name:"实验室检查"}
                ]},
        {name:"第二次随访",
            open:false,
            children:[
                {name:"随访信息表"},
                {name:"实验室检查"}
            ]}
    ];
    $(document).ready(function(){
        zTreeObj = $.fn.zTree.init($("#treeDemo"), setting, zNodes);
        fuzzySearch('treeDemo','#key',null,true); //初始化模糊搜索方法
    });

    var tableColumns = [
        {field: 'followId', title: '序号',align:'center'},
        {field: 'followTime', title: '随访时间',align:'center'},
        {field: 'groupName', title: '随访组',align:'center'},
        {field: 'dictionaryName', title: '科室',align:'center'},
        {field: 'followState', title: '随访状态',align:'center',formatter : function (value, row, index) {
                return value==true||value=='true' ? '开放' : '关闭';}},
    ];

    $('#tableL01').bootstrapTable('destroy');   //动态加载表格之前，先销毁表格
    $('#tableL01').bootstrapTable({//表格初始化
        columns: tableColumns,  //表头
        //url:'/findPatients',
        //data:data1, //通过ajax返回的数据
        url:'findFollowUp',
        method: 'get',
        pageNumber: 1,//初始化加载第一页
        cache: false,
        striped: true,
        pagination: true,
        sidePagination: 'client',
        pageSize: 3,//单页记录数
        pageList: [3, 5, 10, 20],//可选择单页记录数
        search: false,
        theadClasses: "thead-blue",
        showRefresh: false,
        showExport: false,
        showFooter: true,
        silent:true,
        // exportTypes: ['csv', 'txt', 'xml'],
        clickToSelect: true,
        toolbar:'#toolbar',
        //得到查询的参数
        queryParams:function queryParams(params) {
            var param = {
                outpatientService:$('#outpatientService').val(),//门诊号
                hospitalizationNumber:$('#hospitalizationNumber').val(),//住院号
                patientSex: $('#sex').val(),//性别
                preTime: $('#preTime').val(),//前时间
                sufTime: $('#sufTime').val(),//后时间
                patientName: $('#patientName').val()//姓名
            };
            return param;
        }
    });



</script>
</html>